@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using PugetSound
@using PugetSound.Logic
@model PugetSound.Models.IndexModel
@{
    ViewData["Title"] = "PugetSound";
    ViewData["Page"] = "home";
}

<div class="container">
    <div class="row">
        <div class="col-12">
            <h1>Welcome <span>@Model.FriendlyName</span></h1>
            <p><strong>PugetSound</strong> allows you and your group to enjoy music together using Spotify.</p>
            <div class="mt-3 mb-3 pl-3 border-left border-success">
                <p>You are signed into Spotify with the username: <a href="@Model.ProfileLink">@Model.UserName</a></p>
                <p class="mb-0">@Model.PlaylistMessage<a href="@Model.PlaylistLink">@Constants.QueuePlaylistName</a></p>
            </div>
            <hr />
            <h2>Join or create room</h2>
            @if (Model.IsAlreadyInRoom)
            {
                <div class="alert alert-info">
                    <p>You've joined room <strong>@Model.RoomName</strong> previously, so that has been pre-filled below. Just press [Enter room] to continue.</p>
                    <p class="mb-0">If you enter a different room name you'll leave your current one.</p>
                </div>
            } else if (!string.IsNullOrWhiteSpace(Model.RoomName))
            {
                <div class="alert alert-info">
                    <p class="mb-0">You received a deeplink for room <strong>@Model.RoomName</strong>, so that has been pre-filled below. Just press [Enter room] to join.</p>
                </div>
            }
            <p><em>Letters and hyphens allowed. On room creation spaces will be converted to hyphens, other disallowed will be removed. 3 characters minimum.</em></p>
            <form method="post" asp-contoller="Index" asp-action="Room">
                <input type="hidden" asp-for="PlaylistId" value="@Model.PlaylistId" />
                <input asp-for="RoomName" pattern="[-a-zA-Z]{3,}" value="@Model.RoomName" />
                <input type="submit" value="Enter room" />
            </form>
            <hr />
            <h3 class="mt-5"><a data-toggle="collapse" href="#area-howitworks" role="button" aria-expanded="true" aria-controls="area-howitworks">How it works</a></h3>
            <div id="area-howitworks" class="collapse show">
                <p>PugetSound creates a playlist called "PugetSound Queue" in your Spotify account. When you join a room and become a DJ, you'll take turns to play a song for the room members. When it's your turn, the first song from your queue playlist will be played for everyone, and it'll be also removed from said playlist. (Therefore it's not recommended to use it for other purposes.)</p>
                <p>Unlike other solutions, PugetSound handles the synchronization and queueing on the backend, so it's not necessary to keep the tab open - as long as you have a Spotify player open on a device. This also means that you need to re-enter the room and explicitly press the [Leave room] button to retake control of your Spotify account.</p>
            </div>
            <h3><a data-toggle="collapse" href="#area-reqs" role="button" aria-expanded="false" aria-controls="area-reqs" class="collapsed">Requirements</a></h3>
            <div id="area-reqs" class="collapse">
                <p>1. Spotify Premium: Apparently a premium account is required to play songs via the API.</p>
                <p>2. Keeping <em>a</em> Spotify player open <em>somewhere</em>. This can be the desktop client, your phone or the web app. Doesn't matter, but the music needs to come from somewhere.</p>
            </div>
            <h3><a data-toggle="collapse" href="#area-knownissues" role="button" aria-expanded="false" aria-controls="area-knownissues" class="collapsed">Known issues</a></h3>
            <div id="area-knownissues" class="collapse">
                <p>Sometimes we don't get a refresh token while authenticating, which causes all Spotify related actions to fail after your access token expires (normally 1 hour). To solve this, just leave the room, refresh this page, and join again.</p>
            </div>
            <h3><a data-toggle="collapse" href="#area-else" role="button" aria-expanded="false" aria-controls="area-else" class="collapsed">Everything else</a></h3>
            <div id="area-else" class="collapse">
                <p>This is an open source project <a href="https://github.com/tomzorz/PugetSound">available on GitHub</a>!</p>
            </div>
        </div>
    </div>
</div>